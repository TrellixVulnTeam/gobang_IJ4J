{"ast":null,"code":"import { reactive, ref, onMounted, inject, onDeactivated, onUnmounted } from 'vue';\nimport Chessboard from \"@/components/chessboard\";\nexport default {\n  name: \"Gobang\",\n  components: {\n    Chessboard\n  },\n\n  setup() {\n    const global = inject('global');\n    const axios = inject('axios');\n    let websocket_url = 'ws://localhost:9999/gobang/';\n    let ws;\n    /*\r\n    * page_num:\r\n    * 1 选择创建or加入\r\n    * 2 创建页面\r\n    * 3 加入页面\r\n    * 4 棋盘页面\r\n    * */\n\n    const radioStyle = reactive({\n      display: 'flex',\n      height: '30px',\n      lineHeight: '30px'\n    });\n    const chessboard_num = ref(\" \");\n    chessboard_num.value = ''; //棋盘号\n\n    let xianshouOrhoushou = ref(true); //创建棋盘函数\n\n    function createChessboard() {\n      let create_url = global.http_local_url + 'gobang/createChessboard/' + global.username + '/' + xianshouOrhoushou.value;\n      console.log(create_url);\n      axios.get(create_url).then(res => {\n        const resData = res.data;\n        console.log(resData);\n\n        if (resData.code === 0) {\n          chessboard_num.value = resData.data.chessboard_num;\n          let ws_url = websocket_url + global.username + '/' + chessboard_num.value;\n          init(ws_url);\n        }\n      });\n    }\n\n    function joinChessboard() {\n      let join_url = global.http_local_url + 'gobang/isChessboard/' + chessboard_num.value;\n      let isChessboard = false;\n      axios.get(join_url).then(res => {\n        console.log(res.data);\n        let data = res.data.data;\n\n        if (res.data.code === 0 && data.isChessboard === true) {\n          isChessboard = true;\n        }\n      });\n\n      if (isChessboard) {\n        let ws_url = websocket_url + global.username + '/' + chessboard_num.value;\n        init(ws_url);\n      }\n    }\n\n    function init(websocket_url) {\n      ws = new WebSocket(websocket_url);\n      ws.onopen = open;\n      ws.onerror = error;\n      ws.onclose = onclose;\n      ws.onmessage = getMessage;\n    }\n\n    function open() {\n      console.log(\"socket连接成功\");\n    }\n\n    function error() {\n      alert(\"websocket发生意外\");\n    }\n\n    function getMessage(msg) {\n      console.log(msg.data);\n    }\n\n    function send(params) {\n      ws.send(params);\n    }\n\n    function onclose() {\n      console.log(\"socket已关闭\");\n    }\n\n    function close() {\n      if (ws && ws.readyState === 1) {\n        ws.close();\n        console.log(\"主动关闭socket连接\");\n      }\n    }\n\n    onUnmounted(() => {\n      console.log(\"onUnmounted\");\n      close();\n    });\n    return {\n      page_num: ref(1),\n      radioStyle,\n      xianshouOrhoushou,\n      chessboard_num,\n      createChessboard,\n      joinChessboard\n    };\n  }\n\n};","map":{"version":3,"mappings":"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","names":["reactive","ref","onMounted","inject","onDeactivated","onUnmounted","Chessboard","name","components","setup","global","axios","websocket_url","ws","radioStyle","display","height","lineHeight","chessboard_num","value","xianshouOrhoushou","createChessboard","create_url","http_local_url","username","console","log","get","then","res","resData","data","code","ws_url","init","joinChessboard","join_url","isChessboard","WebSocket","onopen","open","onerror","error","onclose","onmessage","getMessage","alert","msg","send","params","close","readyState","page_num"],"sourceRoot":"","sources":["C:\\gobang\\gobang\\view\\src\\components\\Gobang.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <div id=\"pre_zhanwei\"></div>\r\n    <div id=\"content\">\r\n      <div v-show=\"page_num<=3\">\r\n        <a-button v-on:click=\"page_num=2\">创建棋盘</a-button>\r\n        <a-button v-on:click=\"page_num=3\">加入棋盘</a-button>\r\n      </div>\r\n      <div v-show=\"page_num===2\">\r\n        <h1>创建页面</h1>\r\n        <div>\r\n          <a-radio-group v-model:value=\"xianshouOrhoushou\">\r\n            <a-radio :style=\"radioStyle\" :value=\"true\">先手</a-radio>\r\n            <a-radio :style=\"radioStyle\" :value=\"false\">后手</a-radio>\r\n          </a-radio-group>\r\n        </div>\r\n        <a-button v-on:click=\"createChessboard\">确认创建</a-button>\r\n      </div>\r\n      <div v-show=\"page_num===3\">\r\n        <h1>加入页面</h1>\r\n        <a-input  size=\"large\" v-model:value=\"chessboard_num\" placeholder=\"请输入房间号\" />\r\n        <a-button v-on:click=\"joinChessboard;\">确认加入</a-button>\r\n      </div>\r\n      <div v-show=\"page_num===4\">\r\n        <chessboard></chessboard>\r\n      </div>\r\n\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {reactive, ref, onMounted, inject, onDeactivated, onUnmounted} from 'vue'\r\nimport Chessboard from \"@/components/chessboard\";\r\nexport default {\r\n  name: \"Gobang\",\r\n  components: {Chessboard},\r\n  setup(){\r\n\r\n    const global=inject('global');\r\n    const axios=inject('axios');\r\n\r\n    let websocket_url='ws://localhost:9999/gobang/';\r\n    let ws;\r\n\r\n    /*\r\n    * page_num:\r\n    * 1 选择创建or加入\r\n    * 2 创建页面\r\n    * 3 加入页面\r\n    * 4 棋盘页面\r\n    * */\r\n    const radioStyle = reactive({\r\n      display: 'flex',\r\n      height: '30px',\r\n      lineHeight: '30px',\r\n    });\r\n    const chessboard_num=ref(\" \");\r\n    chessboard_num.value='';\r\n    //棋盘号\r\n    let xianshouOrhoushou=ref(true);\r\n\r\n    //创建棋盘函数\r\n    function createChessboard(){\r\n      let create_url=global.http_local_url+'gobang/createChessboard/'+global.username+'/'+xianshouOrhoushou.value;\r\n      console.log(create_url)\r\n      axios.get(create_url).then(res=>{\r\n        const resData=res.data;\r\n        console.log(resData);\r\n        if(resData.code===0){\r\n          chessboard_num.value=resData.data.chessboard_num;\r\n          let ws_url=websocket_url+global.username+'/'+chessboard_num.value;\r\n          init(ws_url);\r\n        }\r\n      })\r\n    }\r\n    function joinChessboard(){\r\n      let join_url=global.http_local_url+'gobang/isChessboard/'+chessboard_num.value;\r\n      let isChessboard=false;\r\n      axios.get(join_url)\r\n          .then(\r\n              res=>{\r\n                console.log(res.data);\r\n                let data=res.data.data;\r\n                if(res.data.code===0&&data.isChessboard===true){\r\n                  isChessboard=true;\r\n                }\r\n\r\n              }\r\n          );\r\n      if(isChessboard){\r\n        let ws_url=websocket_url+global.username+'/'+chessboard_num.value;\r\n        init(ws_url);\r\n      }\r\n    }\r\n\r\n    function init(websocket_url){\r\n      ws=new WebSocket(websocket_url);\r\n      ws.onopen=open;\r\n      ws.onerror=error;\r\n      ws.onclose=onclose;\r\n      ws.onmessage=getMessage;\r\n    }\r\n    function open(){\r\n      console.log(\"socket连接成功\");\r\n    }\r\n\r\n    function error(){\r\n      alert(\"websocket发生意外\")\r\n    }\r\n    function getMessage(msg){\r\n      console.log(msg.data)\r\n    }\r\n    function send(params){\r\n      ws.send(params)\r\n    }\r\n\r\n    function onclose(){\r\n      console.log(\"socket已关闭\")\r\n    }\r\n\r\n    function close(){\r\n      if(ws&&ws.readyState===1){\r\n        ws.close();\r\n        console.log(\"主动关闭socket连接\")\r\n      }\r\n    }\r\n    onUnmounted(()=>{\r\n      console.log(\"onUnmounted\");\r\n      close();\r\n    })\r\n    return{\r\n      page_num:ref(1),\r\n      radioStyle,\r\n      xianshouOrhoushou,\r\n      chessboard_num,\r\n      createChessboard,\r\n      joinChessboard,\r\n    }\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n#pre_zhanwei{\r\n  display: inline-block;\r\n  width: 33%;\r\n}\r\n#content{\r\n  display: inline-block;\r\n}\r\n#content .ant-input {\r\n  width: 200px;\r\n  margin: 0 8px 8px 0;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module"}